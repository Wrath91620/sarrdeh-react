{"ast":null,"code":"let supportedFormat;\nlet id = 0;\nexport class BasisManager {\n  constructor(workerSrc, gl) {\n    if (!supportedFormat) supportedFormat = this.getSupportedFormat(gl);\n    this.onMessage = this.onMessage.bind(this);\n    this.queue = new Map();\n    this.initWorker(workerSrc);\n  }\n  getSupportedFormat(gl = document.createElement('canvas').getContext('webgl')) {\n    /* if (!!gl.getExtension('WEBGL_compressed_texture_etc')) {\r\n        return 'etc2';\r\n    } else  */\n    if (!!gl.getExtension('WEBGL_compressed_texture_astc')) {\n      return 'astc';\n    } else if (!!gl.getExtension('EXT_texture_compression_bptc')) {\n      return 'bptc';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_s3tc')) {\n      return 's3tc';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_etc1')) {\n      return 'etc1';\n    } else if (!!gl.getExtension('WEBGL_compressed_texture_pvrtc') || !!gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc')) {\n      return 'pvrtc';\n      // } else if (!!gl.getExtension('WEBGL_compressed_texture_atc')) {\n      //     return 'atc';\n    }\n    return 'none';\n  }\n  initWorker(workerSrc) {\n    this.worker = new Worker(workerSrc);\n    this.worker.onmessage = this.onMessage;\n  }\n  onMessage({\n    data\n  }) {\n    const {\n      id,\n      error,\n      image\n    } = data;\n    if (error) {\n      console.log(error, id);\n      return;\n    }\n    const textureResolve = this.queue.get(id);\n    this.queue.delete(id);\n    image.isBasis = true;\n    textureResolve(image);\n  }\n  parseTexture(buffer) {\n    id++;\n    this.worker.postMessage({\n      id,\n      buffer,\n      supportedFormat\n    });\n    let textureResolve;\n    const promise = new Promise(res => textureResolve = res);\n    this.queue.set(id, textureResolve);\n    return promise;\n  }\n}","map":{"version":3,"names":["supportedFormat","id","BasisManager","constructor","workerSrc","gl","getSupportedFormat","onMessage","bind","queue","Map","initWorker","document","createElement","getContext","getExtension","worker","Worker","onmessage","data","error","image","console","log","textureResolve","get","delete","isBasis","parseTexture","buffer","postMessage","promise","Promise","res","set"],"sources":["C:/Users/Sarrdeh Tech/Desktop/Sarrdeh-React/sarrdeh-react/node_modules/ogl/src/extras/BasisManager.js"],"sourcesContent":["let supportedFormat;\r\nlet id = 0;\r\n\r\nexport class BasisManager {\r\n    constructor(workerSrc, gl) {\r\n        if (!supportedFormat) supportedFormat = this.getSupportedFormat(gl);\r\n        this.onMessage = this.onMessage.bind(this);\r\n        this.queue = new Map();\r\n        this.initWorker(workerSrc);\r\n    }\r\n\r\n    getSupportedFormat(gl = document.createElement('canvas').getContext('webgl')) {\r\n        /* if (!!gl.getExtension('WEBGL_compressed_texture_etc')) {\r\n            return 'etc2';\r\n        } else  */\r\n        if (!!gl.getExtension('WEBGL_compressed_texture_astc')) {\r\n            return 'astc';\r\n        } else if (!!gl.getExtension('EXT_texture_compression_bptc')) {\r\n            return 'bptc';\r\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_s3tc')) {\r\n            return 's3tc';\r\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_etc1')) {\r\n            return 'etc1';\r\n        } else if (!!gl.getExtension('WEBGL_compressed_texture_pvrtc') || !!gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc')) {\r\n            return 'pvrtc';\r\n            // } else if (!!gl.getExtension('WEBGL_compressed_texture_atc')) {\r\n            //     return 'atc';\r\n        }\r\n        return 'none';\r\n    }\r\n\r\n    initWorker(workerSrc) {\r\n        this.worker = new Worker(workerSrc);\r\n        this.worker.onmessage = this.onMessage;\r\n    }\r\n\r\n    onMessage({ data }) {\r\n        const { id, error, image } = data;\r\n        if (error) {\r\n            console.log(error, id);\r\n            return;\r\n        }\r\n        const textureResolve = this.queue.get(id);\r\n        this.queue.delete(id);\r\n        image.isBasis = true;\r\n        textureResolve(image);\r\n    }\r\n\r\n    parseTexture(buffer) {\r\n        id++;\r\n        this.worker.postMessage({\r\n            id,\r\n            buffer,\r\n            supportedFormat,\r\n        });\r\n        let textureResolve;\r\n        const promise = new Promise((res) => (textureResolve = res));\r\n        this.queue.set(id, textureResolve);\r\n        return promise;\r\n    }\r\n}\r\n"],"mappings":"AAAA,IAAIA,eAAe;AACnB,IAAIC,EAAE,GAAG,CAAC;AAEV,OAAO,MAAMC,YAAY,CAAC;EACtBC,WAAWA,CAACC,SAAS,EAAEC,EAAE,EAAE;IACvB,IAAI,CAACL,eAAe,EAAEA,eAAe,GAAG,IAAI,CAACM,kBAAkB,CAACD,EAAE,CAAC;IACnE,IAAI,CAACE,SAAS,GAAG,IAAI,CAACA,SAAS,CAACC,IAAI,CAAC,IAAI,CAAC;IAC1C,IAAI,CAACC,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC;IACtB,IAAI,CAACC,UAAU,CAACP,SAAS,CAAC;EAC9B;EAEAE,kBAAkBA,CAACD,EAAE,GAAGO,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAACC,UAAU,CAAC,OAAO,CAAC,EAAE;IAC1E;AACR;AACA;IACQ,IAAI,CAAC,CAACT,EAAE,CAACU,YAAY,CAAC,+BAA+B,CAAC,EAAE;MACpD,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACV,EAAE,CAACU,YAAY,CAAC,8BAA8B,CAAC,EAAE;MAC1D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACV,EAAE,CAACU,YAAY,CAAC,+BAA+B,CAAC,EAAE;MAC3D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACV,EAAE,CAACU,YAAY,CAAC,+BAA+B,CAAC,EAAE;MAC3D,OAAO,MAAM;IACjB,CAAC,MAAM,IAAI,CAAC,CAACV,EAAE,CAACU,YAAY,CAAC,gCAAgC,CAAC,IAAI,CAAC,CAACV,EAAE,CAACU,YAAY,CAAC,uCAAuC,CAAC,EAAE;MAC1H,OAAO,OAAO;MACd;MACA;IACJ;IACA,OAAO,MAAM;EACjB;EAEAJ,UAAUA,CAACP,SAAS,EAAE;IAClB,IAAI,CAACY,MAAM,GAAG,IAAIC,MAAM,CAACb,SAAS,CAAC;IACnC,IAAI,CAACY,MAAM,CAACE,SAAS,GAAG,IAAI,CAACX,SAAS;EAC1C;EAEAA,SAASA,CAAC;IAAEY;EAAK,CAAC,EAAE;IAChB,MAAM;MAAElB,EAAE;MAAEmB,KAAK;MAAEC;IAAM,CAAC,GAAGF,IAAI;IACjC,IAAIC,KAAK,EAAE;MACPE,OAAO,CAACC,GAAG,CAACH,KAAK,EAAEnB,EAAE,CAAC;MACtB;IACJ;IACA,MAAMuB,cAAc,GAAG,IAAI,CAACf,KAAK,CAACgB,GAAG,CAACxB,EAAE,CAAC;IACzC,IAAI,CAACQ,KAAK,CAACiB,MAAM,CAACzB,EAAE,CAAC;IACrBoB,KAAK,CAACM,OAAO,GAAG,IAAI;IACpBH,cAAc,CAACH,KAAK,CAAC;EACzB;EAEAO,YAAYA,CAACC,MAAM,EAAE;IACjB5B,EAAE,EAAE;IACJ,IAAI,CAACe,MAAM,CAACc,WAAW,CAAC;MACpB7B,EAAE;MACF4B,MAAM;MACN7B;IACJ,CAAC,CAAC;IACF,IAAIwB,cAAc;IAClB,MAAMO,OAAO,GAAG,IAAIC,OAAO,CAAEC,GAAG,IAAMT,cAAc,GAAGS,GAAI,CAAC;IAC5D,IAAI,CAACxB,KAAK,CAACyB,GAAG,CAACjC,EAAE,EAAEuB,cAAc,CAAC;IAClC,OAAOO,OAAO;EAClB;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}